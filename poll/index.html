---
layout: page
title: Ott leszek!
shortname: poll
order: 5
group: otletborze
---
<!-- remove after end of poll -->
<div id="fb-root"></div>
<script type="text/javascript">
	ajax_error = function () {
		jQuery("#poll").html(
			"<strong style=\"color: red;\">Hiba t√∂rt√©nt a szerverrel val√≥ kommunik√°ci√≥ sor√°n. Z√°rd be ezt az ablakot √©s pr√≥b√°ld √∫jra k√©s≈ëbb! Ha nem tudsz √∫jra szavazni, akkor a szavazatodat sikeresen fogadtuk √©s a hiba a hiba jelz√©s√©ben keletkezett :)</strong>"
		);
	}

	// add_input = function () {
	// 	jQuery("#poll .custom-votes").append(
	// 		"<div class=\"progress poll-progress\"><input type=\"text\" class=\"form-control new-vote\" placeholder=\"√öj zenekar nev√©t itt adhatod meg\"/></div>"
	// 	);
	// }

	window.fbAsyncInit = function () {
		FB.init({
			appId: '267323596708516',
			status: true,
			cookie: true,
			xfbml: true
		});
		jQuery.ajax({
			url: '/api/poll',
			dataType: 'json',
			type: 'GET',
		}).done(function (data) {
			console.log(data);
			var max = 0;
			var num = 0;
			var tmp;
			jQuery.each(data, function (k, v) {
				num++;
				tmp = parseInt(v);
				if (max < tmp) max = tmp;
			});
			if (num > 0) {
				poll = jQuery("#poll").html("<div class=\"custom-votes\"></div>");
				jQuery.each(data, function (k, v) {
					tmp = v / max * 90;
					e = jQuery("<div class=\"progress poll-progress\" data-value=\"" + k +
						"\"><div class=\"progress-bar progress-bar-info\" role=\"progressbar\" aria-valuenow=\"" + tmp +
						"\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: " + tmp + "%\"><span>" + k +
						"</span></div></div>");
					e.click(function () {
						if (jQuery(this).hasClass("selected")) {
							add_input();
							jQuery(this).removeClass("selected");
						} else if (jQuery(".poll-progress.selected").length < 3) {
							jQuery(".custom-votes .new-vote").last().parent().remove();
							jQuery(this).addClass("selected");
						}
					});
					poll.prepend(e);
				});
				// add_input();
				// add_input();
				// add_input();
				var btn = jQuery(
					"<button class=\"btn\" id=\"vote-button\"><i class=\"fa-fw fa-facebook fa\"></i> Szavaz√°s</button>");
				btn.click(function () {
					jQuery(this).remove();
					FB.login(function (response) { // log in
						if (response.authResponse) { // logged in
							FB.api('/me/permissions', function (response) { // request permissions
								r = response.data;
								checkPerm = function (a, p) {
									for (var i = 0; i < a.length; i++) {
										console.log(a[i]);
										if (a[i].permission == p && a[i].status == "granted") {
											return true;
										}
									}
									return false;
								};
								if (checkPerm(r, "email") && checkPerm(r,
									"public_profile")) {
									data = {};
									jQuery.each(jQuery(".poll-progress.selected"), function (k, v) {
										data[jQuery(v).data("value")] = 1;
									});
									jQuery.each(jQuery(".new-vote"), function (k, v) {
										if (jQuery(v).val() != "") data[jQuery(v).val()] = 1;
									});
									jQuery("#poll").html(
										"<p class=\"text-center\"><i class=\"fa fa-spinner fa-spin fa-5x\"></i></p>");
									jQuery.ajax({
										url: '/api/poll',
										dataType: 'json',
										type: 'PATCH',
										data: {
											votes: data
										}
									}).done(function (data) {
										jQuery("#poll").html("<strong style=\"color: red;\">" + data.message +
											" Az oldal p√°r m√°sodpercen bel√ºl √∫jrat√∂lt≈ëdik...</strong>");
										document.getElementById("navigation").scrollIntoView();
										if (data.votes) {
											FB.ui({
												method: 'share',
												href: 'https://gombaszog.sk/poll',
												quote: "Ha csak h√°rom koncertre m√©sz el Gombasz√∂g√∂n, ezek legyenek azok: " +
													data.votes + "! Mutasd meg ismer≈ëseidnek, hogy melyik bulikon futhattok √∂ssze! üòé",
											}, function (response) {
												setTimeout(function () {
													document.location.reload();
												}, 5000);
											});
										} else {
											setTimeout(function () {
												document.location.reload();
											}, 5000);
										}
									}).fail(ajax_error);
								} else { // refresh for permissions
									console.log("Permission error, details: email: " + checkPerm(r, "email") +
										" public_profile: " + checkPerm(r, "public_profile"));
									jQuery("#poll").html(
										"<strong style=\"color: red;\">A szavaz√°shoz el≈ësz√∂r enged√©lyezned kell az alkalmaz√°sunkat. Ha ez megt√∂rt√©nt, t√∂ltsd √∫jra az oldalat!</strong>"
									);
								}
							});
						} else {
							jQuery("#poll").html(
								"<strong style=\"color: red;\">A szavaz√°shoz el≈ësz√∂r be kell jelentkezned a Facebookon!</strong>"
							);
						}
					}, {
						scope: 'email,public_profile'
					});
				});
				jQuery(".poll-buttonspace").append(btn);
			} else {
				jQuery("#poll").html("<strong style=\"color: red;\">A szavaz√°s m√°r nem el√©rhet≈ë!</strong>");
			}
		}).fail(function (data) {
			if (data && data.responseJSON && data.responseJSON.error === "No polls available") {
				jQuery("#poll").html("<strong style=\"color: red;\">A szavaz√°s m√°r nem el√©rhet≈ë!</strong>");
			} else {
				ajax_error();
			}
		});
	};

	(function (d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) {
			return;
		}
		js = d.createElement(s);
		js.id = id;
		js.src = "//connect.facebook.net/en_US/all.js";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));

</script>



<section>
	<div class="container">
		<div class="row">
			<div class="bg">
				<h3>
					<span class="lang-hu">Ott leszek!</span>
					<span class="lang-en" style="display: none;">Bands</span>
				</h3>
				<div>
					<p class="justified">
						<span class="lang-hu">Ha csak h√°rom koncertre m√©sz el Gombasz√∂g√∂n, akkor melyikek lesznek azok?</span>
					</p>
					<p class="justified"><em>
							<span class="lang-hu">√ñsszesen h√°rom zenekarra szavazhatsz!</span>
						</em></p>
				</div>
				<div id="poll">
					<p class="text-center"><i class="fa fa-spinner fa-spin fa-5x"></i></p>
				</div>
				<p class="poll-buttonspace text-center"></p>
				<div>
					<p class="justified">
						<span class="lang-hu"><small>A szavaz√°shoz Facebook-fi√≥k, valamint az alkalmaz√°sunk
								enged√©lyez√©se sz√ºks√©ges.
								Szavazni csak egyszer lehet, maximum h√°rom zenekarra. A hamis Facebook-fi√≥kokkal √©s/vagy gyan√∫s IP-c√≠mekr≈ël √©rkez≈ë
								szavazatokat
								rendszer√ºnk automatikusan sz≈±ri √©s √©rv√©nytelen√≠ti. Ja √©s ne csaljatok!</small></span>
					</p>
				</div>
			</div>
		</div>
	</div>
</section>

<div class="modal fade" id="t_c">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-body">
				<h3>
					<span class="lang-hu">Adatkezel√©si √©s k√∂zz√©t√©teli felt√©telek</span>
        </h3>
				<button type="button" class="close pull-rught" data-dismiss="modal" aria-hidden="true"
					style="color: white;"><i class="fa fa-times"></i></button>
				<p>
					<span class="lang-hu">Az ≈±rlapon megadott adatok tulajdonjog√°t a bek√ºld≈ë a bek√ºld√©s pillanat√°ban
						√°truh√°zza a
						Di√°kh√°l√≥zatra √©s a Sine Metu polg√°ri t√°rsul√°sra. A megadott e-mail c√≠met ellenben a bek√ºld≈ë
						szem√©lyes
						adatjak√©nt kezelik √©s azt harmadik f√©lnek ki nem szolg√°ltatj√°k. <br />A be√©rkez≈ë √∂tletek tov√°bbi
						sors√°t a
						szervez≈ëk egym√°s k√∂z√∂tt d√∂ntik el, melyr≈ël a bek√ºld≈ët nem √©rtes√≠tik.</span>
				</p>
			</div>
		</div>
	</div>
</div>
